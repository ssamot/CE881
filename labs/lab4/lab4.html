<H3><A name=Introduction>Introduction</A></H3>

<p>This is the final lab covering the LightsOn puzzle.&nbsp; The aim is to study 
some further Android topics, and then build these into an improved version of 
LightsOn.</p>
	<p>The main topics to be covered are:</p>
	<ul>
		<li>Menus</li>
		<li>Custom Dialogs</li>
	</ul>
	<p>We'll also pay some attention to how to randomise the puzzle with some 
	care.</p>
	<p>Note: mention is also made of Fragments.&nbsp; We've not covered these 
	yet, but they behave a bit like mini-activities and are useful in building 
	apps that scale well across multiple device resolutions.&nbsp; Fragments are 
	briefly covered in the <a href="../../lectures/Fragments.pptx">Fragments</a> 
	notes, and you can read more
	<a href="http://developer.android.com/guide/components/fragments.html">here</a>.</p>
	<h3><a name="Menus">Menus</a></h3>
	<p>In the previous lab we added an &quot;About&quot; menu to the app.&nbsp; Now by 
	referring to the <a href="../../lectures/Menus%20And%20Dialogs.pptx">Menus 
	and Dialogs</a> lecture notes or the Android developer resources add at 
	another menu item called Options, and create specific icons for your menu 
	items, and also experiment with adding them to the ActionBar.</p>
	<p>The <a href="MenusAndDialogs.zip">MenusAndDialogs.zip</a> project 
	contains the code discussed in the lecture, including the experiemtal 
	dynamic icon generation code.</p>
	<h3><a name="Custom Dialogs">Custom Dialogs</a></h3>
	<p><strong>Exercise:</strong></p>
	<p>By&nbsp; referring to the
	<a href="http://developer.android.com/guide/topics/ui/dialogs.html">Dialogs</a> 
	documentation (you might also find the&nbsp;
	<a href="../../lectures/Menus%20And%20Dialogs.pptx">Menus and Dialogs</a> 
	notes useful as they contain some of the key points) create an OptionsDialog 
	that enables the user to select the size of the n x n grid, and also the 
	number of steps that a randomised puzzle will be away from the goal.</p>
	<p>The code provided below offers a partial solution to this.&nbsp; From the 
	Menus part you should already have an &quot;options&quot; item added to the options 
	menu.&nbsp; In the <strong>onOptionsItemSelected</strong> event handling 
	method add the following code to handle the selection of the &quot;options&quot; item 
	(define a static variable for this called <strong>optionsItem</strong>).</p>
	<p><img alt="OptionsMenu" height="104" src="OptionsMenu.PNG" width="625"></p>
	<p>We then need to create the CustomDialogFragment class, and example of 
	which is shown below.&nbsp; This will follow on from the examples provided 
	in the the
	<a href="http://developer.android.com/guide/topics/ui/dialogs.html">Dialogs</a> 
	documentation.&nbsp; Note the following:</p>
	<ul>
		<li>This is a simple example that uses a single number picker</li>
		<li>It relies on some static variables having been defined in the parent 
		Activity class such as <strong>nGridMax</strong> (CustomDialogFragment 
		is defined as an inner class within the main Activity class (e.g. 
		LightsActivity)</li>
		<li>Being an inner class gives it convenient access to the instance 
		variables and methods of the Activity</li>
		<li>An instance variable of the Activity called <strong>nGrid</strong> 
		has been defined to select the grid size</li>
		<li><strong>nGrid</strong> is used to provide a default value to the 
		number picker</li>
		<li>To keep the example self contained and simple I've created the 
		custom view (in fact, the NumberPicker) in the Java code</li>
		<li>The call to builder.<strong>setView</strong> is the one that sets 
		the custom view</li>
		<li>In both negative and positive button options the value of nGrid is 
		retained, but only in the positive option called &quot;New Game&quot; is the new 
		game initiated immediately</li>
	</ul>
	<p>
	<img alt="CustomDialogFragment" height="692" src="CustomDialogFragment.PNG" width="865"></p>
	<p>Interestingly, the default behaviour of this is rather annoying:: it pops 
	up a keyboard as illustrated below.&nbsp; This could be useful sometimes, 
	but for selecting numbers from such a small range is just ridiculous.</p>
	<p><img alt="With Keyboard" height="384" src="WithKeyboard.png" width="240"></p>
	<p><strong>Fixing this:</strong> by doing a web search work out how to 
	disable the keyboard, and arrive at the more satisfactory behaviour shown 
	below:</p>
	<p>
	<img alt="Without Keyboard" height="384" src="WithoutKeyboard.png" width="240"></p>
	<p>To finish off this part you can either add more to a single custom 
	dialog, or alternatively add another item to the options menu to pop a 
	different custom dialog to enable selection of the number of steps to goal.</p>
	<h3><a name="Randomising the Puzzle">Randomising the Puzzle</a></h3>
	<p>In this section we return to some model logic that is independent of 
	Android.</p>
	<p>Suppose you start the puzzle in the solved state with all the lights on.&nbsp; 
	How will you guarantee to put the puzzle in a state which is <em>n</em> 
	steps away from the solution?&nbsp; </p>
	<p>Actually, this is a potentially difficult problem as <em>n</em> gets 
	large.&nbsp; However, for small n there are probably some simple tricks you 
	can use to avoid obvious errors.&nbsp; An obviously erroneous algorithm 
	would be:</p>
	<pre>repeat n times
  pick a grid square at random and flip the lights for that square</pre>
	<p>Question: why is that erroneous?&nbsp; (think how it could go horribly 
	wrong even for <em>n</em>=2)</p>
	<p>Note: you should also add a Randomise button to your app to invoke the 
	randomise function.</p>
	<h3><a name="Game State">Game State</a></h3>
	<p>Finally, you may want to add some game state management.&nbsp; This is 
	distinct from the lifecycle state of the app, but can be useful in managing 
	the app while it is in the resumed state.&nbsp; For example, if the user 
	wishes to change the grid size, you might disallow this during the middle of 
	a game (or at least warn that this will destroy the current game).</p>
	<h3><a name="Solutions">Solutions</a></h3>
	<p>Parts of this lab have been a bit open-ended - so we'll be very 
	interested to see the solutions you develop!&nbsp; A solution that 
	demostrates the key concepts will be circulated some time after the lab.</p>
	<p>&nbsp;</p>
